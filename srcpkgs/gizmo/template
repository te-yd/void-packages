# Template file for 'gizmo'
pkgname=gizmo
version=0.2.2
revision=1
_commit=e2b58a421227d3b4bf3d5292a0ad906eb5a3dfbf
build_style=go
go_import_path=github.com/gizmo-platform/gizmo
go_ldflags="-X ${go_import_path}/pkg/buildinfo.Version=${version}
 -X ${go_import_path}/pkg/buildinfo.Commit=${_commit}"
short_desc="Software for the Gizmo Mechatronics Platform"
maintainer="Michael Aldridge <maldridge@gizmoplatform.org>"
license="ISC"
homepage="https://gizmoplatform.org"
distfiles="https://github.com/gizmo-platform/gizmo/archive/refs/tags/v${version}.tar.gz"
checksum=a74cf2208ed9e2b6b4a7bf6149135b350e9e1033eb9d825595b7c2925e133eaf

post_install() {
	vsv gizmo-fms
	vlicense LICENSE
}

gizmo-fms_package() {
	short_desc+=" - FMS"
	depends="${sourcepkg}>=${version}_${revision} apache-htpasswd dialog terraform gizmo-docs"
	make_dirs="/var/lib/gizmo 0755 _gizmo _gizmo"
	system_accounts="_gizmo"
	_gizmo_homedir="/var/lib/gizmo"
	_gizmo_shell="/bin/nologin"
	_gizmo_descr="Unprivileged service account"

	pkg_install() {
		vmove etc/sv/gizmo-fms
	}
}
